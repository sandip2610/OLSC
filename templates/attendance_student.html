<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Attendance Calendar</title>
    <style>
        body {font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;background-color: #f4f6f8;margin: 0;padding: 0px;}
        h2 {text-align: center;color: #333;margin-bottom: 10px;}
        .calendar {display: grid;grid-template-columns: repeat(7, 1fr);gap: 10px;max-width: 1200px;margin: 0 auto;}
        .day {padding: 25px;text-align: center;background-color: #fff;border-radius: 5px;box-shadow: 0 4px 8px rgba(0,0,0,0.1);transition: transform 0.2s, box-shadow 0.2s;}
        .day:hover {transform: scale(1.05);box-shadow: 0 6px 12px rgba(0,0,0,0.15);}
        .present {background-color: #a2f5a2;}
        .absent {background-color: #f5a2a2;}
        .day-number {font-weight: bold;margin-bottom: 5px;}
        .legend {display: flex;justify-content: center;gap: 20px;margin-top: 20px;}
        .legend div {display: flex;align-items: center;gap: 5px;}
        .legend span {display: inline-block;width: 20px;height: 20px;border-radius: 4px;}
        .summary {margin-top: 3px;text-align: center;font-size: 18px;color: #333;font-weight: bold;margin-bottom: 30px;}
    </style>
</head>
<body>
{% extends "base.html" %}
{% block title %}Smart School{% endblock %}
{% block content %}
<h2>Your Attendance Calendar</h2>
<div class="summary" id="attendanceSummary"></div>
<div class="calendar" id="attendanceCalendar">
    {% for date, status in attendance_by_date.items %}
    <div class="day {% if status == 'Present' %}present{% else %}absent{% endif %}">
        <div class="day-number">{{ date|date:"d/m/y" }}</div>
        <div class="status">{{ status }}</div>
    </div>
    {% endfor %}
</div>
<div class="legend">
    <div><span class="present"></span> Present</div>
    <div><span class="absent"></span> Absent</div>
</div>
<script>
    window.onload = function () {
        const days = document.querySelectorAll(".calendar .day");
        let totalDays = 0;
        let presentDays = 0;
        const now = new Date();
        const currentMonth = now.getMonth();
        const currentYear = now.getFullYear();
        days.forEach(day => {
            const dateText = day.querySelector(".day-number").innerText;
            const [d, m, y] = dateText.split("/"); // format d/m/y
            const jsDate = new Date(`20${y}`, m - 1, d); // y small so adding "20"
            if (jsDate.getMonth() === currentMonth && jsDate.getFullYear() === currentYear) {
                totalDays++;
                if (day.classList.contains("present")) {
                    presentDays++;
                }
            }
        });
        let percentage = totalDays > 0 ? ((presentDays / totalDays) * 100).toFixed(2) : 0;
        document.getElementById("attendanceSummary").innerText =
            `This Month: Present = ${presentDays}/${totalDays} (${percentage}%)`;
    }
</script>
{% endblock %}
</body>
</html>