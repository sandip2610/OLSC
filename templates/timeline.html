<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Timeline</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
    <style>
        body {background-color: #f0f2f5;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;}
        .timeline-container {max-width: 700px;margin: 0px auto;}
        .timeline-card {border: none;border-radius: 0 !important;box-shadow: 0 2px 6px rgba(0,0,0,0.08);transition: transform 0.2s ease, box-shadow 0.2s ease;margin-bottom: 0 !important;}
        .post-content {font-size: 12px;}
        .card-title {font-weight: 600;color: #050505;}
        .card-time {font-size: 13px;color: #65676b;}
        .card-text {margin-top: 8px;margin-bottom: 12px;color: #1c1e21;}
        .post-content img,
        .post-content video {max-width: 100%;border-radius: 2px;}
        .btn-new-post {border-radius: 2px;font-weight: 500;}
        .profile-card {display: flex;align-items: center;gap: 10px;}
        .profile-img {width: 50px;height: 50px;border-radius: 50%;object-fit: cover;border: 2px solid #ddd;}
        .profile-info {display: flex;flex-direction: column;}
        .card-text {margin-top: 8px;margin-bottom: 0px;color: #1c1e21;font-size: 14px;}
        .clamp-text {
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
            white-space: normal;
        }
        .show-more {color: #0d6efd;cursor: pointer;font-size: 10px;font-weight: 500;}
    </style>
</head>
<body>
{% extends "base.html" %}
{% load static %}
{% block title %}Smart School{% endblock %}
{% block content %}
<div class="timeline-container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h3 class="fw-bold" >üìå Timeline</h3>
        <button class="btn btn-primary btn-new-post" data-bs-toggle="modal" data-bs-target="#uploadModal">
            ‚ûï New Post
        </button>
    </div>
    {% for status in statuses %}
    <div class="card mb-4 timeline-card position-relative">
        <div class="card-body d-flex">
            <div class="post-content w-100">
<div class="d-flex justify-content-between align-items-start mb-2 pb-2"
     style="border-bottom:2px solid #e0e0e0;">
                    <div class="profile-card">
                        {% if status.student.photo %}
                            <img src="{{ status.student.photo.url }}" alt="{{ status.student.photo.url }}" class="profile-img" style="width: 60px;height: 60px;border-radius: 50%;object-fit: cover;border: 2px solid black;">
                        {% else %}
                            <img src="{% static 'img_5.png' %}" alt="Default Profile" class="profile-img">
                        {% endif %}
                        <div class="profile-info">
                            <h5 class="card-title mb-0">{{ status.student.name }}</h5>
                            <small class="card-time">{{ status.timestamp|date:"d M Y, H:i" }}</small>
                        </div>
                    </div>
                    {% if status.student.id == request.session.student_id %}
                    <div class="dropdown">
                        <button class="btn btn-link text-dark p-0" type="button" id="dropdownMenuButton{{ status.id }}" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-three-dots-vertical"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdownMenuButton{{ status.id }}">
                            <li>
                                <form method="POST" action="{% url 'delete_timeline' status.id %}" style="display:inline;">
                                    {% csrf_token %}
                                    <button type="submit" class="dropdown-item text-danger" onclick="return confirm('üõë Are you sure you want to delete this timeline?');">
                                        üóëÔ∏è Delete
                                    </button>
                                </form>
                            </li>
                        </ul>
                    </div>
                    {% endif %}
                </div>
                {% if status.text %}
                <div class="card-text clamp-text" id="text-{{ status.id }}">
                    {{ status.text|linebreaksbr }}
                </div>
                {% if status.text|length > 100 %}
                    <span class="show-more" onclick="toggleText({{ status.id }})" id="toggle-{{ status.id }}">
                        More
                    </span>
                {% endif %}
            {% endif %}
                {% if status.content %}
                    {% if status.is_video %}
                        <video controls class="mb-3">
                            <source src="{{ status.content.url }}" type="video/mp4">
                            Your browser does not support the video tag.
                        </video>
                    {% elif status.is_image %}
                        <img src="{{ status.content.url }}" class="mb-3" alt="Status Image">
                    {% endif %}
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <p class="text-center text-muted">No posts yet.</p>
    {% endfor %}
</div>
<div class="modal fade" id="uploadModal" tabindex="-1" aria-labelledby="uploadModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <form method="POST" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="modal-header">
          <h5 class="modal-title" id="uploadModalLabel">‚ûï Create New Post</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          {{ form.as_p }}
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Post</button>
        </div>
      </form>
    </div>
  </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function toggleText(id) {
    let text = document.getElementById("text-" + id);
    let toggleBtn = document.getElementById("toggle-" + id);
    if (text.classList.contains("clamp-text")) {
        text.classList.remove("clamp-text");
        toggleBtn.innerText = "Less";
    } else {
        text.classList.add("clamp-text");
        toggleBtn.innerText = "More";
    }
}
</script>
{% endblock %}
</body>
</html>